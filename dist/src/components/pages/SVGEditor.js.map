{"version":3,"file":"SVGEditor.js","sourceRoot":"","sources":["../../../../src/components/pages/SVGEditor.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, LitElement } from 'lit';\nimport { customElement, state } from 'lit/decorators.js';\nimport { ConnectionStatus } from '../../types/network.types';\nimport { Coordinates } from '../../types/types';\nimport { Editor } from '../../util/Editor';\nimport { Tools_List } from '../../util/helper/constants';\nimport { Connection } from '../../util/network';\nimport { DrawZone } from '../atoms/DrawZone';\nimport { FooterFields } from '../molecules/FooterFields';\nimport {\n  layoutStyle,\n  layoutHeaderStyle,\n  layoutContentStyle,\n} from '../templates/EditorTemplate/EditorTemplate.styles';\nimport '../templates/EditorTemplate';\nimport { EditorTemplate } from '../templates/EditorTemplate';\n\n@customElement('svg-editor')\nexport class SVGEditor extends LitElement {\n  @state()\n  isLoading: boolean;\n  @state()\n  width: number = 0;\n  @state()\n  height: number = 0;\n  @state()\n  editor: Editor | null = null;\n  @state()\n  position?: Coordinates;\n  @state()\n  connection?: Connection;\n  @state()\n  chatLog: Array<{ userName: string; message: string }> = [];\n  @state()\n  connectionStatus: ConnectionStatus =\n    this.connection?.getStatus() ?? 'disconnected';\n  static styles = [layoutStyle, layoutHeaderStyle, layoutContentStyle];\n\n  constructor() {\n    super();\n    this.isLoading = true;\n  }\n\n  firstUpdated() {\n    this.#updateResize();\n  }\n\n  #updateChatLog = (chatLog: Array<{ userName: string; message: string }>) => {\n    this.chatLog = [...chatLog];\n  };\n\n  #updateConnection = (status: ConnectionStatus) => {\n    this.connectionStatus = status;\n  };\n\n  updated(_changedProperties: Map<string | number | symbol, unknown>): void {\n    const svgEditor = this.shadowRoot?.getElementById(\n      'editor'\n    ) as EditorTemplate;\n    if (!this.editor && this.editor !== _changedProperties.get('editor')) {\n      const drawZone = svgEditor.shadowRoot?.getElementById('draw-zone') as\n        | DrawZone\n        | undefined;\n      const drawLayer = drawZone?.shadowRoot?.getElementById(\n        'draw-layer'\n      ) as HTMLCanvasElement;\n      const previewLayer = drawZone?.shadowRoot?.getElementById(\n        'preview-layer'\n      ) as HTMLCanvasElement | undefined;\n      if (drawLayer && previewLayer) {\n        new ResizeObserver(this.#updateResize).observe(drawLayer);\n        const footerFields = svgEditor.shadowRoot?.querySelector(\n          'footer-fields'\n        ) as FooterFields;\n        this.editor = new Editor(\n          drawLayer,\n          previewLayer,\n          [previewLayer.offsetLeft, previewLayer.offsetTop],\n          svgEditor,\n          footerFields\n        );\n\n        this.connection = new Connection(\n          this.editor.deleteFromShapes,\n          this.editor.updateShapes,\n          this.editor.getAllShapes,\n          this.editor.resetEditor,\n          this.#updateConnection,\n          this.#updateChatLog,\n          this.editor.setConnection,\n          'localhost',\n          '8080'\n        );\n      }\n    }\n    if (this.editor && this.connection) {\n      this.isLoading = false;\n    }\n  }\n\n  #handleSelectTool = (tool: Tools_List | null) => {\n    this.editor?.onSelectTool(tool);\n  };\n\n  #handleJoinRoom = (data: { userName?: string; roomId?: string }) => {\n    const { userName, roomId } = data;\n    if (this.editor && roomId && this.connection) {\n      this.connection.connect(roomId, userName);\n      document.title = document.title + ' | Room:' + roomId;\n    }\n  };\n\n  #handleLeaveRoom = () => {\n    this.connection?.disconnect();\n    document.title = 'SVG Editor';\n  };\n\n  #updateResize = () => {\n    this.width = window.innerWidth;\n    this.height = window.innerHeight;\n  };\n\n  #handlePositionChange = (position?: Coordinates) =>\n    (this.position = position);\n\n  render() {\n    return html`<editor-template\n      id=\"editor\"\n      .width=${this.width}\n      .height=${this.height}\n      .chatLog=${this.chatLog}\n      .connection=${this.connection}\n      .editor=${this.editor}\n      .connectionStatus=${this.connectionStatus}\n      .position=${this.position}\n      .onJoinRoom=${this.#handleJoinRoom}\n      .onLeaveRoom=${this.#handleLeaveRoom}\n      .onMousePositionChange=${this.#handlePositionChange}\n      .onSelectTool=${this.#handleSelectTool}\n    ></editor-template>`;\n  }\n}\n"]}