{"version":3,"file":"SVGEditor.js","sourceRoot":"","sources":["../../../../../src/components/organisms/SVGEditor/SVGEditor.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, LitElement } from 'lit';\nimport { customElement, state } from 'lit/decorators.js';\nimport { nanoid } from 'nanoid';\nimport { ConnectionStatus } from '../../../types/network.types';\nimport { Coordinates } from '../../../types/types';\nimport { Editor } from '../../../util/Editor';\nimport { Tools_List } from '../../../util/helper/constants.js';\nimport { Connection } from '../../../util/network';\nimport '../../atoms/MenuButton';\nimport '../../atoms/PositionInformation';\nimport '../../atoms/ToolboxButton';\nimport type { ToolboxButtonPropsType } from '../../atoms/ToolboxButton/ToolboxButton.types';\nimport '../../molecules/ConnectionSection';\nimport '../../molecules/DialogSection';\nimport '../../molecules/DrawZone';\nimport type { DrawZone } from '../../molecules/DrawZone';\nimport '../../molecules/FooterFields';\nimport { FooterFields } from '../../molecules/FooterFields';\nimport '../../molecules/ToolBox';\nimport {\n  layoutContentStyle,\n  layoutHeaderStyle,\n  layoutStyle,\n} from './SVGEditor.styles';\nimport { getToolboxButtonsProps } from './SVGEditor.util';\n\n@customElement('svg-editor')\nexport class SVGEditor extends LitElement {\n  @state()\n  width: number = 0;\n  @state()\n  height: number = 0;\n  @state()\n  editor: Editor | null = null;\n  @state()\n  position?: Coordinates;\n  @state()\n  connection?: Connection;\n  @state()\n  chatLog: Array<{ userName: string; message: string }> = [];\n  @state()\n  connectionStatus: ConnectionStatus =\n    this.connection?.getStatus() ?? 'disconnected';\n\n  static styles = [layoutStyle, layoutHeaderStyle, layoutContentStyle];\n\n  firstUpdated() {\n    this.#updateResize();\n  }\n\n  #updateChatLog = (chatLog: Array<{ userName: string; message: string }>) => {\n    this.chatLog = [...chatLog];\n  };\n\n  #updateConnection = (status: ConnectionStatus) => {\n    this.connectionStatus = status;\n  };\n\n  updated(_changedProperties: Map<string | number | symbol, unknown>): void {\n    if (!this.editor && this.editor !== _changedProperties.get('editor')) {\n      const drawZone = this.shadowRoot?.getElementById('draw-zone') as\n        | DrawZone\n        | undefined;\n      const drawLayer = drawZone?.shadowRoot?.getElementById(\n        'draw-layer'\n      ) as HTMLCanvasElement;\n      const previewLayer = drawZone?.shadowRoot?.getElementById(\n        'preview-layer'\n      ) as HTMLCanvasElement | undefined;\n      if (drawLayer && previewLayer) {\n        new ResizeObserver(this.#updateResize).observe(drawLayer);\n        const footerFields = this.shadowRoot?.querySelector(\n          'footer-fields'\n        ) as FooterFields;\n        this.editor = new Editor(\n          drawLayer,\n          previewLayer,\n          [previewLayer.offsetLeft, previewLayer.offsetTop],\n          this,\n          footerFields\n        );\n\n        this.connection = new Connection(\n          this.editor.deleteFromShapes,\n          this.editor.updateShapes,\n          this.editor.getAllShapes,\n          this.editor.resetEditor,\n          this.#updateConnection,\n          this.#updateChatLog,\n          this.editor.setConnection\n        );\n      }\n    }\n  }\n\n  #handleSelectTool = (tool: Tools_List | null) => {\n    this.editor?.onSelectTool(tool);\n  };\n\n  #handleJoinRoom = (data: { userName?: string; roomId?: string }) => {\n    const { userName, roomId } = data;\n    if (this.editor && roomId && this.connection) {\n      this.connection.connect(roomId, userName);\n      document.title = document.title + ' | Room:' + roomId;\n    }\n  };\n\n  #handleLeaveRoom = () => {\n    this.connection?.disconnect();\n    document.title = 'SVG Editor';\n  };\n\n  #updateResize = () => {\n    this.width = window.innerWidth;\n    this.height = window.innerHeight;\n  };\n\n  #handlePositionChange = (position?: Coordinates) =>\n    (this.position = position);\n\n  protected render() {\n    const tools: ToolboxButtonPropsType[] = getToolboxButtonsProps(\n      (tools: Tools_List | null) => {\n        this.#handleSelectTool(tools);\n      }\n    );\n\n    return html`\n      <div id=\"content\">\n        <draw-zone\n          id=\"draw-zone\"\n          .height=${this.height}\n          .width=${this.width}\n          .onPositionChange=${this.#handlePositionChange}\n        ></draw-zone>\n        <div id=\"right-main-section\">\n          <tool-box id=\"tool-box\" .tools=${tools}></tool-box>\n          <connection-section\n            .status=${this.connectionStatus}\n            .onJoinRoom=${this.#handleJoinRoom}\n            .onLeaveRoom=${this.#handleLeaveRoom}\n            .onSendMessage=${this.connection?.sendChatMessage}\n            .userName=${this.connection?.getUserName() ?? 'user_' + nanoid(6)}\n            .roomId=${this.connection?.getRoom() ?? ''}\n            .chatLog=${this.chatLog}\n          ></connection-section>\n        </div>\n      </div>\n      <dialog-section\n        .onSave=${this.editor?.onSave}\n        .onSelectSvgFile=${this.editor?.importSVG}\n      ></dialog-section>\n      <div id=\"footer\">\n        <footer-fields\n          .onSVGParamChange=${this.editor?.setShapeParam}\n        ></footer-fields>\n        <position-information .position=${this.position}></position-information>\n      </div>\n    `;\n  }\n}\n"]}