{"version":3,"file":"Shape.js","sourceRoot":"","sources":["../../../../src/util/Shapes/Shape.ts"],"names":[],"mappings":"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","sourcesContent":["import { nanoid } from 'nanoid';\r\nimport type {\r\n  BoundaryCoordinates,\r\n  Coordinates,\r\n  SVGParamsBase,\r\n} from '../../types/types';\r\nimport { textPlaceHolder } from '../helper/constants';\r\nimport { getTextBoundaries } from '../helper/coordinates';\r\nimport { measureText } from '../helper/domUtil';\r\nimport { isText } from '../helper/typeguards';\r\n\r\nexport abstract class Shape {\r\n  static #counter: number = 0;\r\n\r\n  #fill?: string;\r\n  #id: string;\r\n  #stroke?: string;\r\n  #strokeWidth?: string;\r\n  #lineCap?: CanvasLineCap;\r\n  #lineDash?: number[];\r\n  #fontSize?: number;\r\n  #fontFamily?: string;\r\n  isLocked: boolean = false;\r\n  text: string = textPlaceHolder;\r\n  transformMatrix?: DOMMatrix;\r\n  boundaries: BoundaryCoordinates;\r\n  index: number = 0;\r\n\r\n  constructor(\r\n    boundaries: BoundaryCoordinates = [\r\n      [-1, -1],\r\n      [-1, -1],\r\n      [-1, -1],\r\n      [-1, -1],\r\n    ],\r\n    svgParams: Partial<SVGParamsBase> = {},\r\n    countShapecountUp: boolean = true,\r\n    isLocked: boolean = false\r\n  ) {\r\n    if (countShapecountUp) {\r\n      Shape.#counter++;\r\n    }\r\n    this.#id = nanoid();\r\n    this.#fill = svgParams.fill ?? 'rgba(0,0,0,0)';\r\n    this.#stroke = svgParams.stroke ?? 'rgba(0,0,0,1)';\r\n    this.#strokeWidth = svgParams.strokeWidth ?? '1';\r\n    this.#lineDash = svgParams.lineDash ?? [0];\r\n    this.#fontSize = svgParams.fontSize ?? 18;\r\n    this.#fontFamily = svgParams.fontFamily ?? 'Arial';\r\n    this.text = svgParams.text ?? this.text;\r\n    this.transformMatrix = svgParams.transformMatrix;\r\n    this.boundaries = boundaries;\r\n    this.isLocked = isLocked;\r\n    this.index = Shape.#counter;\r\n  }\r\n\r\n  moveTransformMatrix = (x: number, y: number) => {\r\n    const { a, b, c, d, e, f } = this.transformMatrix || new DOMMatrix();\r\n    this.transformMatrix = new DOMMatrix([a, b, c, d, e + x, f + y]);\r\n  };\r\n\r\n  updateSVGParam = (field: keyof SVGParamsBase, value: any) => {\r\n    const currentParams = this.getSvgParams();\r\n    currentParams[field] = value;\r\n    this.updateSVGParams(currentParams);\r\n  };\r\n\r\n  updateSVGParams = (newParams: SVGParamsBase) => {\r\n    this.#fill = newParams.fill;\r\n    this.#stroke = newParams.stroke;\r\n    this.#strokeWidth = newParams.strokeWidth;\r\n    this.#lineCap = newParams.lineCap;\r\n    this.#lineDash = newParams.lineDash;\r\n    this.#fontFamily = newParams.fontFamily;\r\n    this.#fontSize = newParams.fontSize;\r\n    if (isText(this)) {\r\n      this.text = newParams.text ?? this.text;\r\n      const measures = measureText(this.text, this.getSvgParams());\r\n      if (measures) {\r\n        this.boundaries = getTextBoundaries(\r\n          this.getCenter(),\r\n          measures?.width,\r\n          measures?.height\r\n        );\r\n      }\r\n    }\r\n  };\r\n\r\n  replaceID = (id: string) => {\r\n    this.#id = id;\r\n    return this;\r\n  };\r\n\r\n  moveBoundaries = (difference: Coordinates) => {\r\n    const [xDifference, yDifference] = difference;\r\n    this.boundaries = this.boundaries?.map(\r\n      boundary =>\r\n        [boundary[0] + xDifference, boundary[1] + yDifference] as Coordinates\r\n    ) as BoundaryCoordinates;\r\n  };\r\n\r\n  getSvgParams = (): SVGParamsBase => {\r\n    return {\r\n      fill: this.#fill,\r\n      stroke: this.#stroke,\r\n      strokeWidth: this.#strokeWidth,\r\n      transformMatrix: this.transformMatrix,\r\n      lineCap: this.#lineCap,\r\n      lineDash: this.#lineDash,\r\n      fontSize: this.#fontSize,\r\n      fontFamily: this.#fontFamily,\r\n      text: this.text,\r\n    };\r\n  };\r\n\r\n  getId = () => {\r\n    return this.#id;\r\n  };\r\n\r\n  getCenter = (): Coordinates => {\r\n    throw new Error('not implemented');\r\n  };\r\n\r\n  moveTo = (coodinates: Coordinates): void => {\r\n    throw new Error('not implemented');\r\n  };\r\n\r\n  toString = (): string => {\r\n    throw new Error('not implemented');\r\n  };\r\n\r\n  getDeconstructedShapeData = (): any => {\r\n    throw new Error('not implemented');\r\n  };\r\n}\r\n"]}